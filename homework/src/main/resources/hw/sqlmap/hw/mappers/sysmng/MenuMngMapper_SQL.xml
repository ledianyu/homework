<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hw.sysmng.service.impl.MenuMngMapper">

	<resultMap id="menuMap" type="hw.sysmng.service.MenuVO">
		<result property="menuId" column="MENU_ID"/>
		<result property="kname" column="KNAME"/>
		<result property="kdesc" column="KDESC"/>
		<result property="depth" column="DEPTH"/>
		<result property="sort" column="SORT"/>
		<result property="higherId" column="HIGHER_ID"/>
		<result property="programUrl" column="PROGRAM_URL"/>
		<result property="menuType" column="MENU_TYPE"/>
		<result property="icon" column="ICON"/>
		<result property="state" column="STATE"/>
		<collection property="menu2List" column="higherId = MENU_ID" javaType="List" ofType="hw.sysmng.service.MenuVO" select="selectMenuList"/>
	</resultMap>
		 
	<select id="selectMenuList" resultMap="menuMap">
		SELECT TM.MENU_ID
			 , TM.KNAME
			 , TM.KDESC
			 , TM.DEPTH
			 , TM.SORT
			 , TM.HIGHER_ID
			 , TM.PROGRAM_URL
			 , TM.MENU_TYPE
			 , TM.ICON
			 , TM.STATE
			 , CONCAT((SELECT KNAME FROM T_MENU WHERE MENU_ID = TM.HIGHER_ID)," > ",TM.KNAME) AS MENU_PATH
		  FROM T_MENU TM
		<if test="roleYn != null and roleYn.equals('Y')">
		 INNER JOIN T_ROLE TR
		    ON TR.MENU_ID = TM.MENU_ID 
		   AND TR.GROUP_ID = #{groupId}
		   AND (TR.A_YN = 'Y' OR TR.R_YN  = 'Y')
		</if>
		<choose>
			<when  test="higherId != null and !higherId.equals('')">
		 WHERE TM.HIGHER_ID = #{higherId}
			</when>
			<otherwise>
		 WHERE TM.HIGHER_ID = '-'
			</otherwise>
		</choose>
		<if test="state != null and !state.equals('')">
		   AND TM.STATE = #{state}
		</if>
		 ORDER BY TM.SORT
	</select>

</mapper>